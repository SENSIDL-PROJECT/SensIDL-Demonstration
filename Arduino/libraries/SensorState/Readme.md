# Umgebungskachel Datastructure
The communication of the Umgebungskachel Demonstrator with the corresponding Binding in the Qivicon Gateway is implemented as a REST service  hosted by the Arduino board.
The data structure is generated by SensIDL in [Java for the Qivicon](https://github.com/SENSIDL-PROJECT/SensIDL/tree/UmgebungskachelMod/code/demonstration/QIVICON/com.qivicon.eclipse.binding.galileoarduinosensor/src/main/java/com/qivicon/eclipse/binding/galileoarduinosensor/dataobjects) and [C/C++ for the Arduino](https://github.com/SENSIDL-PROJECT/SensIDL/tree/UmgebungskachelMod/code/demonstration/Arduino/libraries/SensorState).

The Data Objects used, are generated by the following code:
```javascript
sensorInterface Umgebungskachel /** communication interface between a sensor and a gateway*/{
	encoding : SENSIDL_JSON, endianness : BIG_ENDIAN , alignment : 1 BIT
	sensorData { 
		dataSet AlertThresholdBrightness /** data description for the brightness threshold */ {
			threshold_brightness as DOUBLE in Ohm /** Upper threshold that triggers an alert if the measured brightness is too high */
		}
		
		dataSet AlertThresholdTemperature /** data description for the temperature threshold */{
			threshold_temperature as DOUBLE in °F adjusted with scaling factor : 1.8 and offset : 32
			/** Upper threshold that triggers an alert if the measured temperature is too high */
		}
		
		dataSet LedToggle /** data description for an switch that controls a light source */ {
			led as STRING in Dimensionless /** Switch for a light source that is either ON or OFF */
		}
		
		dataSet SensorState uses AlertThresholdBrightness, AlertThresholdTemperature,LedToggle
		/**data description of all values the sensor REST-API contains */ {			
			temperature as DOUBLE in °F adjusted with scaling factor : 1.8 and offset : 32
			/** The measured temperature of the Umgebungkachel sensor */
			
			brightness as DOUBLE in Ohm /** The measured brightness of the Umgebungkachel sensor */
		}
	} 
}
```

If there is no change on the Qivicon UI, the Qivicon Binding refreshes it's sensor values periodically every 10 seconds, by simply making a http request to the IP of the Umgebungskachel. The Umgebungskachel responds to this request by returning the SensorState dataSet as a JSON object. A response could look like this:
``` json
{
	"led" : "ON",
	"temperature" : 25.05,
	"brightness" : 5.48,
	"threshold_brightness" : 15,
	"threshold_temperature" : 30
}
```
If the User changes a setting via the Qivicon UI the Qivicon Binding chooses the right dataSet (AlertThresholdBrightness, AlertThresholdTemperature or LedToggle), fills in the new values and sends it as a JSON object via http request to the Intel Galileo. Such an request could look like the following snippet:
``` json
{
	"led" : "OFF"
}
```
The Umgebungskachel demonstrator then changes this value (if the request was valid) and aswers again with an updated SensorState dataSet as shown above.